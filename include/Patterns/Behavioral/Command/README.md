## Команда (Command)  - Также известен как: Действие, Транзакция, Action, Command

Паттерн Command относится к поведенческим паттернам уровня объекта.

Паттерн Command позволяет представить запрос в виде объекта. Из этого следует, что команда - это объект. Такие запросы,
например, можно ставить в очередь, отменять или возобновлять.

В этом паттерне мы оперируем следующими понятиями:
Command - запрос в виде объекта на выполнение;
Receiver - объект-получатель запроса, который будет обрабатывать нашу команду;
Invoker - объект-инициатор запроса.

Паттерн Command отделяет объект, инициирующий операцию, от объекта, который знает, как ее выполнить. Единственное, что
должен знать инициатор, это как отправить команду.

## Пример

Требуется для реализации:

1. Базовый абстрактный класс Command описывающий интерфейс команды;
2. Класс ConcreteCommand, реализующий команду;
3. Класс Invoker, реализующий инициатора, записывающий команду и провоцирующий её выполнение;
4. Класс Receiver, реализующий получателя и имеющий набор действий, которые команда можем запрашивать;

Invoker умеет складывать команды в стопку и инициировать их выполнение по какому-то событию. Обратившись к Invoker можно
отменить команду, пока та не выполнена.

ConcreteCommand содержит в себе запросы к Receiver, которые тот должен выполнять. В свою очередь Receiver содержит
только набор действий (Actions), которые выполняются при обращении к ним из ConcreteCommand.

## Применимость

### Когда вы хотите параметризовать объекты выполняемым действием.

    Команда превращает операции в объекты. А объекты можно передавать, хранить и взаимозаменять внутри других объектов.

    Скажем, вы разрабатываете библиотеку графического меню и хотите, чтобы пользователи могли использовать меню в разных приложениях, не меняя каждый раз код ваших классов. Применив паттерн, пользователям не придётся изменять классы меню, вместо этого они будут конфигурировать объекты меню различными командами.

### Когда вы хотите ставить операции в очередь, выполнять их по расписанию или передавать по сети.

    Как и любые другие объекты, команды можно сериализовать, то есть превратить в строку, чтобы потом сохранить в файл или базу данных. Затем в любой удобный момент её можно достать обратно, снова превратить в объект команды и выполнить. Таким же образом команды можно передавать по сети, логировать или выполнять на удалённом сервере.

### Когда вам нужна операция отмены.

    Главная вещь, которая вам нужна, чтобы иметь возможность отмены операций, — это хранение истории. Среди многих способов, которыми можно это сделать, паттерн Команда является, пожалуй, самым популярным.

    История команд выглядит как стек, в который попадают все выполненные объекты команд. Каждая команда перед выполнением операции сохраняет текущее состояние объекта, с которым она будет работать. После выполнения операции копия команды попадает в стек истории, все ещё неся в себе сохранённое состояние объекта. Если потребуется отмена, программа возьмёт последнюю команду из истории и возобновит сохранённое в ней состояние.

    Этот способ имеет две особенности. Во-первых, точное состояние объектов не так-то просто сохранить, ведь часть его может быть приватным. Но с этим может помочь справиться паттерн Снимок.

    Во-вторых, копии состояния могут занимать довольно много оперативной памяти. Поэтому иногда можно прибегнуть к альтернативной реализации, когда вместо восстановления старого состояния команда выполняет обратное действие. Недостаток этого способа в сложности (а иногда и невозможности) реализации обратного действия.

## Шаги реализации

1. Создайте общий интерфейс команд и определите в нём метод запуска.

2. Один за другим создайте классы конкретных команд. В каждом классе должно быть поле для хранения ссылки на один или
   несколько объектов-получателей, которым команда будет перенаправлять основную работу.

Кроме этого, команда должна иметь поля для хранения параметров, которые нужны при вызове методов получателя. Значения
всех этих полей команда должна получать через конструктор.

И, наконец, реализуйте основной метод команды, вызывая в нём те или иные методы получателя.

3. Добавьте в классы отправителей поля для хранения команд. Обычно объекты-отправители принимают готовые объекты команд
   извне — через конструктор либо через сеттер поля команды.

4. Измените основной код отправителей так, чтобы они делегировали выполнение действия команде.

5. Порядок инициализации объектов должен выглядеть так:
    - Создаём объекты получателей.
    - Создаём объекты команд, связав их с получателями.
    - Создаём объекты отправителей, связав их с командами.

## Преимущества и недостатки

    + Убирает прямую зависимость между объектами, вызывающими операции, и объектами, которые их непосредственно выполняют.
    + Позволяет реализовать простую отмену и повтор операций.
    + Позволяет реализовать отложенный запуск операций.
    + Позволяет собирать сложные команды из простых.
    + Реализует принцип открытости/закрытости.

    - Усложняет код программы из-за введения множества дополнительных классов.

Отношения с другими паттернами

1. `Цепочка обязанностей`, `Команда`, `Посредник` и `Наблюдатель` показывают различные способы работы отправителей
   запросов с их получателями:
   `Цепочка обязанностей` передаёт запрос последовательно через цепочку потенциальных получателей, ожидая, что какой-то
   из них обработает запрос.
   `Команда` устанавливает косвенную одностороннюю связь от отправителей к получателям.
   `Посредник` убирает прямую связь между отправителями и получателями, заставляя их общаться опосредованно, через себя.
   `Наблюдатель` передаёт запрос одновременно всем заинтересованным получателям, но позволяет им динамически
   подписываться или отписываться от таких оповещений.

2. Обработчики в `Цепочке обязанностей` могут быть выполнены в виде `Команд`. В этом случае множество разных операций
   может быть выполнено над одним и тем же контекстом, коим является запрос.

Но есть и другой подход, в котором сам запрос является `Командой`, посланной по цепочке объектов. В этом случае одна и
та же операция может быть выполнена над множеством разных контекстов, представленных в виде цепочки.

3. `Команду` и `Снимок` можно использовать сообща для реализации отмены операций. В этом случае объекты команд будут
   отвечать за выполнение действия над объектом, а снимки будут хранить резервную копию состояния этого объекта,
   сделанную перед самым запуском команды.

4. `Команда` и `Стратегия` похожи по духу, но отличаются масштабом и применением:
   `Команду` используют, чтобы превратить любые разнородные действия в объекты. Параметры операции превращаются в поля
   объекта. Этот объект теперь можно логировать, хранить в истории для отмены, передавать во внешние сервисы и так
   далее.
   С другой стороны, `Стратегия` описывает разные способы произвести одно и то же действие, позволяя взаимозаменять эти
   способы в каком-то объекте контекста.

5. Если `Команду` нужно копировать перед вставкой в историю выполненных команд, вам может помочь `Прототип`.

6. `Посетитель` можно рассматривать как расширенный аналог `Команды`, который способен работать сразу с несколькими
   видами получателей.


