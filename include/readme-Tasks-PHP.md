# Readme


### Заголовок [&uarr;](#Readme)

array_walk и замыкания
yield, fibers, корутины
preg_replace
Написать пример паттерна Singelton
Написать функцию вычисления факториала (рекурсия / итерация)
Сортировка пузырьком, сложность алгоритма
Добавление данных из формы в бд
Вывести структуру дерева каталога на страницу
Чему будет равен $x после выполнения выражения $x = 3 + "15%" + "$25"?
В чем отличие между результатами выполнения
  $aparts = $aparts + $filedata;             
  $aparts = array_merge($aparts, $filedata);



$a = '1';
$b = &$a;
$b = "2$b";
echo $a.", ".$b;

Если по опыту работы кандидата было видно, что с интерфейсами он знаком и с рекурсией уже сталкивался не раз, чтобы не мучать его общими 
вопросами, я предлагал провести беседу в формате "Что будет, если …?", где кандидат пытался решить смоделированную мной ситуацию, а я 
выступаю в роли компилятора его решений. Выглядело это так:

- Допустим, Вы попали в ситуацию - Вас взяли на работу, задача - дорабатывать и развивать уже готовый проект. Через неделю Вашего знакомства с проектом, маркетинговый отдел запустил довольно успешную кампанию и время загрузки сайта за сутки увеличилось с 0.5c до 15с. Как вы будете решать проблему?
- Посмотрю на вывод SHOW PROCESSLIST; в консоли MySQL на кол-во и время выполнения запросов.
- Хорошо. Допустим, там постоянно висит 2-3 различных запроса с большим временем выполнения. Ваши действия?
- Оптимизация базы, индексы, объединения.
- Ок, а если много различных запросов с небольшим временем выполнения?
- Необходимо использовать кэширование запросов
- Ок, допилили кэширование, но проблема все же осталась
- Некорректная работа кэширующего механизма?
- Допустим. Давайте немного скорректируем условия - вы открываете консоль MySQL и видите там обычное кол-во запросов. В чем ещё может быть проблема?

И ещё 40 минут в таком же духе. Мои любимые темы - тестирование запросов на малых объемах данных, когда на production данных значительно 
больше, вложенные запросы страниц, подтягивание внешнего источника (напр. RSS фида) в основном потоке, когда внешний источник упал и т.п. 
В этом диалоге также есть не-явная суть - проверить мышление кандидата, узнать где и как он ищет решение проблем ("я не знаю, погуглю" - 
без иронии, один из лучших ответов), может ли он допустить проблему в стороннем системном компоненте и готов ли разобраться с этой проблемой,
как хорошо он знает механику работы web-приложений, которая лежит за рамками серверной части.



— У нас есть 10 микросервисов, нам надо авторизовать запросы на них. Как будем решать?
— Я бы взял JWT.
— Хорошая идея, а как будем обрабатывать логауты, ведь JWT не хранит состояние?
— Сделаем короткие токены как в OAuth и при логауте будем на сутки класть их в блек-лист
— Прикольно, а на чем запилим блек-лист?
— Нужен какой-то быстрый кеш, я бы взял Redis
— Охуенно, а как будешь масштабировать когда перестанем влезать в память? ...


### Задачки [&uarr;](#Readme)




- написать пример применения анонимных функций
- написать небольшую реализацию паттерна Singleton.
- Авторизация на сайте - написать на чистом PHP



1. подсчитать количество хитов
Задача: у меня есть banner.php, пусть он выводит статичное изображение, какой-то банер. Мы включаем его на страницу просто <img src="/banner.php"/>
Мне нужно знать, сколько раз мы его показали.

Определение количества уникальных посещений действительно лучше сделать с помощью сессий или кукисов. 
А хранить лучше всего это в NoSQL базе данных.







1) Написать функцию вычисления факториала (рекурсия / итерация)


    function f($n)
    {
        return($n < 2 ? 1 : $n * f($n-1));
    }
    
    echo f(5); // 5!=1*2*3*4*5 = 120



2) Любимый вопрос, для самый умных - "Если приложение будет представлять из себя только один файл следующего содержания, можно ли считать это 
MVC?". Удивительно, сколько людей начинали паниковать и нести ахинею, когда выдели такую реализацию.

    $config = [
    'db' => [
    'host' => '127.0.0.1',
    'user' => 'root',
    'pass' => '',
    'use'  => 'database',
    ]
    ];
    
    
    function model_posts($id = NULL) {
    $sql = "SELECT * FROM posts WHERE id = ?";
    return db_query($sql, [$id]);
    }
    
    function controller_post($id = NULL) {
    if ($model = model_posts($id)) {
    return view('../templates/post.php', [
    'post' => $model
    ]);
    }
    
        return false;
    }
    
    function view($template, Array $variables = array()) {
    ob_start();
    extract($variables);
    include $template;
    return ob_get_clean();
    }
    
    function db_query($sql, Array $params = array()) {
    global $config;
    $db = new PDO($config['db']['dsn'], $config['db']['user'], $config['db']['passwd']);
    $query = $db->prepare($sql);
    $query->execute($params);
    return $query->fetchAll();
    }
    
    function dispatch() {
    $result = FALSE;
    $uri = $_SERVER['REQUEST_URI'];
    
        if (preg_match('#^/post/(?P\d+)/?$#ui', $uri, $matches)) {
            $result = controller_post($matches['id']);
        }
    
        // ...
    
        if ($result) {
            echo $result;
        } else {
            die('Error');
        }
    }
    
    dispatch();
